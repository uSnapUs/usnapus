<% @topbar_class = "hidden" %>

<div class="branding_overlay">
  <%= link_to (image_tag "logo-header.png", :title => "Powered by uSnap.us"), event_photos_path(@event) %>
</div>

<!--Thumbnail Navigation-->
<div id="prevthumb"></div>
<div id="nextthumb"></div>

<!--Arrow Navigation-->
<a id="prevslide" class="load-item"></a>
<a id="nextslide" class="load-item"></a>

<div id="thumb-tray" class="load-item">
	<div id="thumb-back"></div>
	<div id="thumb-forward"></div>
</div>

<!--Time Bar-->
<div id="progress-back" class="load-item">
	<div id="progress-bar"></div>
</div>

<!--Control Bar-->
<div id="controls-wrapper" class="load-item">
	<div id="controls">
		
		<a id="play-button">
		  <%= image_tag "supersized/pause.png", :id => "pauseplay" %>
		</a>
	
		<!--Slide counter-->
		<div id="slidecounter">
			<span class="slidenumber"></span> / <span class="totalslides"></span>
		</div>
		
		<!--Slide captions displayed here-->
		<div id="slidecaption"></div>
		
		<!--Thumb Tray button-->
		<a id="tray-button">
		  <%= image_tag "supersized/button-tray-up.png", :id => "tray-arrow" %>
		</a>
		
		<!--Navigation-->
		<ul id="slide-list"></ul>
		
	</div>
</div>

<% content_for(:head) do %>
  <%= stylesheet_link_tag "supersized", "supersized.shutter" %>
<% end %>
<% content_for(:extra_scripts) do %>
  <%= javascript_include_tag "jquery.easing.min", "supersized.3.2.6.min", "supersized.shutter.min" %>
<% end %>

<%= content_for(:jquery) do %>
  
  var photos = []
  
  //Load all the photos asynchronously on page load
  $.getJSON("<%= "/events/#{@event.id}/photos#{"?limit=1" if params[:live]}"%>", function(data){
    
    $.each(data, function(i, photo_data) {
      
      photos.push({
        image: photo_data["photo"]["url"],
        thumb: photo_data["photo"]["polaroid"]["url"],
        title: "Photo by "+photo_data["device_name"]
      });
    });
    
    $.supersized({
			slide_interval:   3000,
			transition:   3,
			transition_speed		:	700,						
			slide_links				:	'blank',
			slides 					: photos,
			horizontal_center: 1,
			vertical_center: 1<% if params[:live] %>,autoplay:0<% end %>
		});
    
    <% if params[:live] %>
      console.log("Live");
      
  		//Go to new photos when they come in
      var pusher = new Pusher('2e4efb9ca1181106d096');
      var channel = pusher.subscribe('<%= "event-#{@event.id}-photocast" %>');
      channel.bind('new_photo', function(data) {
        pushPhotoToSlideshow(data);
      });

    <% end %>
    
  });
		
<% end %>

<% if params[:live] %>
  <script src="http://js.pusher.com/1.11/pusher.min.js" type="text/javascript"></script>
<% end %>  


<script type="text/html" id="supersized_slide_template">
  <li class="slide-{{slide_id}}">
  {{#photo}}
    <a target="{{href}}">
      <img src="{{base_src}}">
    </a>
  {{/photo}}
  </li>
</script>

<script type="text/html" id="supersized_bullet_template">
<li class="slide-link-{{slide_id}}"><a></a></li>
</script>

<script type="text/html" id="supersized_thumb_template">
<li class="thumb{{slide_id}}">{{#photo}}<img src="{{smaller_src}}">{{/photo}}</li>
</script>